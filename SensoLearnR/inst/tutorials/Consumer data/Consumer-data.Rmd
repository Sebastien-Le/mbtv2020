---
title: "Analyzing consumer data"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```


## Topic 1

### Exercise 

*Here's a simple exercise with an empty code chunk provided for entering the answer.*

Write the R code required to add two plus two:

```{r two-plus-two, exercise=TRUE}

```

### Exercise with Code

*Here's an exercise with some prepopulated code as well as `exercise.lines = 5` to provide a bit more initial room to work.*

Now write a function that adds any two numbers and then call it:

```{r add-function, exercise=TRUE, exercise.lines = 5}
add <- function() {
  
}
```

## Topic 2

### Exercise with Hint

*Here's an exercise where the chunk is pre-evaulated via the `exercise.eval` option (so the user can see the default output we'd like them to customize). We also add a "hint" to the correct solution via the chunk immediate below labeled `print-limit-hint`.*

Modify the following code to limit the number of rows printed to 5:

```{r print-limit, exercise=TRUE, exercise.eval=TRUE}
mtcars
```

```{r print-limit-hint}
head(mtcars)
```

### Quiz

*You can include any number of single or multiple choice questions as a quiz. Use the `question` function to define a question and the `quiz` function for grouping multiple questions together.*

Some questions to verify that you understand the purposes of various base and recommended R packages:

```{r quiz}
quiz(
  question("Which package contains functions for installing other R packages?",
    answer("base"),
    answer("tools"),
    answer("utils", correct = TRUE),
    answer("codetools")
  ),
  question("Which of the R packages listed below are used to create plots?",
    answer("lattice", correct = TRUE),
    answer("tools"),
    answer("stats"),
    answer("grid", correct = TRUE)
  )
)
```

# 1. Understanding the notion of preference

Which one do you prefer between the plague and the cholera?
I'm sure that you like none of them, but you certainly do have a preference. Before having a look at the Ideal Profile Method, we have to make sure that the notion of preference (*versus* liking) is well understood.

## 1.1. The hedonic scores

For this study, 222 consumers tasted 6 chocolates and rated them on a 10 points hedonic scale. The data can be found in the SensoMineR package, but we're going to import them. These are the same data you used yesterday.


The data are continuous. Each consumer is described by a vector of 6 numbers: the liking scores given for each one of the products.

Now, let's run a *PCA* on these data in order to understand our consumers from a multivariate perspective.

```{r}
library(FactoMineR)
res.pca.hedo <- PCA(chocolates_hedo,graph=F)
plot.PCA(res.pca.hedo,choix="var")
plot.PCA(res.pca.hedo,choix="ind")
```

How would you interpret these graphical outputs?

Now, let's focus on the representation of the individuals. What do you think of the two consumers *j68* and *j208*?

```{r}
plot.PCA(res.pca.hedo,choix="ind",axes=c(1,2),title="Hedonic data on dim. 1 & 2",
new.plot=T,select=c("j68","j208"))
```

**Remark.** If you want to get a representation of the variables on the dimensions 2 and 3, run the following lines: 

```{r}
plot.PCA(res.pca.hedo,choix="var",axes=c(2,3),title="Hedonic data on dim. 2 & 3",
new.plot=T)
```


Instead of looking at the consumers one by one, let's make clusters of consumers. When the parameter *nb.clust* is set to -1, it means that the tree is automatically cut by some kind of statistical algorithm.

```{r}
res.hcpc.hedo <- HCPC(res.pca.hedo,nb.clust=-1)
```

Let's have a look at the results and let's see how many clusters were chosen automatically. 

```{r}
names(res.hcpc.hedo)
summary(res.hcpc.hedo$data.clust)
```

To interpret the clusters, refer to their description by the variables. How would you interpret these clusters?

```{r}
plot.HCPC(res.hcpc.hedo,choice="map",draw.tree=F)
res.hcpc.hedo$desc.var
```

We've seen what is often called a size effect. It happens when all the variables are positively correlated. In this case, the information on liking is not particularly interesting. Let's focus on preferences.

## 1.2. The hedonic scores centered by row

Now let's have a look at the same data but centered by row.

After the importation, let's have a look at the so-called margin of the data set (*i.e* the sum over the rows or the columns).

It was expected, but as you can see the sum over the columns for a given row is equal to zero. Let's understand these preferences data from a multivariate point of view. Remember, we got rid of the *scale effect* associated with each subject.

Now you have understood the difference between preference and liking, particularly in terms of statistical analysis. In the following part, we will illustrate the notion of supplementary individuals (or variables) in a multivariate analysis such as PCA.

**Remark.** If you want to get rid of the labels or to select some of them, just use the following code.

```{r}
plot.PCA(res.pca.pref,choix="ind",axes=c(1,2),title="Preference data on dim. 1 & 2",
new.plot=T,select=c("j68","j208"))
plot.PCA(res.pca.pref,choix="ind",axes=c(1,2),title="Preference data on dim. 1 & 2",
label="none")
```

# 2. Focus on the supplementary individuals

Let's say that you have products and consumers, and that you have at your disposal two types of information: the hedonic scores provided by the consumers on the products, and some measures on the products (physical, chemical or sensory measures). This situation is quite common in a product development context.

In our example, 30 smoked salmons we're assessed by more than 1000 consumers.

**Note.** The data we're using to illustrate this paragraph are provided courtesy from participants to the European project EUROSALMON -Improved quality of smoked salmon for the European consumer (MATRA - Technological Institute of Iceland, Iceland; IFREMER - Institut Français de Recherche pour l’Exploitation de la Mer, France; IMR - Institute of Marine Research, Norway; ADRIANT, France).
